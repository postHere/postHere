<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>내 위치 주변 Fin'd 찾기</title>

    <!-- [추가] CSRF 메타 (POST /around-finds 호출을 위한 헤더 구성에 사용) -->
    <meta name="_csrf" th:attr="content=${_csrf?.token}">
    <meta name="_csrf_header" th:attr="content=${_csrf?.headerName}">

    <!-- 기존 로딩 순서 유지 -->
    <link rel="stylesheet" th:href="@{/css/find-on-map.css}">
    <script defer th:src="@{/js/bundle.js}"></script>
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/main-nav.css}">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
</head>
<body id="page-on-map">
<div id="app-container">
    <div id="map"></div>

    <!-- [유지] 상단 주소 칩(동 · 도로명) -->
    <div aria-live="polite" id="address-chip">주소를 불러오는 중…</div>

    <!-- [변경 설명] 기존 전면 모달 오버레이는 더 이상 사용하지 않습니다(InfoWindow로 대체).
         - 남겨두되, JS에서 열지 않습니다(향후 회귀 대비). -->
    <div aria-hidden="true" class="modal-overlay" id="marker-modal">
        <div class="modal-content">
            <img alt="Profile" id="modal-profile-image" src="">
            <span id="modal-nickname"></span>
            <button id="modal-find-button">Fin'd로 이동</button>
            <button aria-label="닫기" id="modal-close-button">&times;</button>
        </div>
    </div>

    <!-- ▼▼▼ [유지] 구글 콜백 안전장치: 전역 initFindOnMap이 호출되면 번들의 __initFindOnMap 실행 -->
    <script>
        window.initFindOnMap = function () {
            if (typeof window.__initFindOnMap === 'function') {
                window.__initFindOnMap();
            }
        };
    </script>

    <!-- ▼▼▼ [중요: Google Maps는 콜백으로만 시작] -->
    <!-- [변경 없음] v=weekly + loading=async 그대로 유지. libraries는 불필요해 제외 -->
    <script async
            th:src="@{'https://maps.googleapis.com/maps/api/js?key=' + ${googleMapsApiKey} + '&callback=initFindOnMap&loading=async&v=weekly'}"></script>

    <!-- ▼▼▼ [유지] 하단 내비 -->
    <div th:replace="~{fragment/main-nav :: mainNavFragment(active='message')}"></div>
</div>
</body>
</html>

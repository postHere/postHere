<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="/pwa/manifest.json" rel="manifest">
</head>
<body>
<div class="main-nav-bar" th:fragment="mainNavFragment">
    <nav>
        <footer class="footer-nav">
            <!-- ê¸°ì¡´ ì•„ì´ì½˜ ê·¸ëŒ€ë¡œ ìœ ì§€ -->
            <a href="/">ğŸ </a>
            <a href="/messages">âœ‰ï¸</a>
            <a href="/forum">ğŸ“</a>

            <!-- ğŸ”” ì¢… ì•„ì´ì½˜ì— ë¹¨ê°„ ì  ì¶”ê°€ (ë§í¬ ê²½ë¡œëŠ” /notification) -->
            <a href="/notification" id="nav-bell-link" style="text-decoration:none">
                ğŸ””
                <span id="nav-bell-dot"
                      style="display:none;width:8px;height:8px;background:#ef4444;border-radius:50%;
                     display:inline-block;vertical-align:top;margin-left:2px"></span>
            </a>

            <a href="/profile">ğŸ‘¤</a>
        </footer>
    </nav>

    <!-- ê¸°ì¡´ main-nav.js ê·¸ëŒ€ë¡œ ë¡œë“œ (ì—¬ê¸°ì— authHeaders ë“± ìœ í‹¸ ìˆìŒ) -->
    <script src="/js/main-nav.js"></script>

    <!-- ì§„ì… ì‹œ ë¯¸ì½ìŒ ê°œìˆ˜ ë°˜ì˜: >0 ì´ë©´ ë¹¨ê°„ ì  í‘œì‹œ -->
    <script>
        (async function () {
            try {
                const res = await fetch('/notification/unread-count', {
                    method: 'POST',
                    // main-nav.jsì— ìˆëŠ” authHeaders ì‚¬ìš©(ìˆìœ¼ë©´ CSRF, ì—†ìœ¼ë©´ ê·¸ëƒ¥ í†µê³¼)
                    headers: (typeof authHeaders === 'function')
                        ? authHeaders({Accept: 'application/json'})
                        : {Accept: 'application/json'}
                });
                if (!res.ok) return;
                const n = await res.json(); // ì„œë²„ê°€ ìˆ«ì(long)ë¡œ ì‘ë‹µ
                const dot = document.getElementById('nav-bell-dot');
                if (dot) dot.style.display = (n > 0) ? 'inline-block' : 'none';
            } catch (e) {
                // ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ ì¡°ìš©íˆ íŒ¨ìŠ¤
            }
        })();
    </script>
</div>
</body>
</html>

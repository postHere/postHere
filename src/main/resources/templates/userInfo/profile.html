<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport">
    <title>Profile - PostHere</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link rel="manifest" th:href="@{/pwa/manifest.json}">
    <script defer th:src="@{/js/bundle.js}"></script>
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <link rel="stylesheet" th:href="@{/css/profile.css}">
    <link rel="stylesheet" th:href="@{/css/main-nav.css}">
</head>
<body id="page-profile" th:data-is-my-profile="${isMyProfile}" th:data-profile-nickname="${profileUser.nickname}">
<div id="app-container">
    <div class="mobile-container">
        <main class="main-content">
            <!-- Section 1: 회원 정보 -->
            <div class="profile-header-wrapper">
                <section class="profile-header">
                    <div class="profile-info">
                        <label class="profile-info__pic-label" th:for="${isMyProfile} ? 'profile-image-upload' : ''">
                            <img alt="Profile Picture"
                                 class="profile-info__pic"
                                 th:src="${profileUser.profilePhotoUrl}">
                        </label>
                        <input accept="image/*" id="profile-image-upload" style="display: none;" th:if="${isMyProfile}"
                               type="file">
                        <div class="profile-info__text">
                            <h2 class="profile-info__name" th:text="|${profileUser.nickname}|"></h2>

                            <!-- [변경사항] 다른 사람 프로필일 때 왼쪽 정보 블록에서 팔로우 버튼을 제거합니다.
                                 기존 마크업은 유지하되, 조건을 false로 고정하여 렌더링되지 않게 합니다.
                                 팔로우 버튼은 우측 액션 영역으로 이동합니다. -->
                            <div class="follow-button-container" th:if="${false}"></div>

                            <div class="profile-stats">
                                <a th:href="@{/friends(nickname=${profileUser.nickname}, tab='followers')}">
                                    <span th:text="|Follower ${profileUser.followerCount}|"></span>
                                </a>
                                <a th:href="@{/friends(nickname=${profileUser.nickname}, tab='followings')}">
                                    <span th:text="|Following ${profileUser.followingCount}|"></span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- [추가사항] 헤더 우측 액션 영역:
                         - 내 프로필이면 동그란 편집 버튼(#open-edit-modal-btn)을 표시
                         - 다른 사람 프로필이면 같은 자리에 Follow/Following 버튼을 표시 -->
                    <div class="profile-action">
                        <button aria-label="프로필 편집 열기" class="profile-action-btn" id="open-edit-modal-btn"
                                th:if="${isMyProfile}"></button>

                        <div class="profile-action-follow" th:if="${!isMyProfile}">
                            <button class="follow-btn follow"
                                    th:data-userid="${profileUser.userId}"
                                    th:if="${!profileUser.isFollowing}">Follow
                            </button>
                            <button class="follow-btn unfollow"
                                    th:data-userid="${profileUser.userId}"
                                    th:if="${profileUser.isFollowing}">Following
                            </button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Section 2: PARK명록 -->
            <div class="guestbook-wrapper">
                <a th:href="@{/park/{nickname}(nickname=${profileUser.nickname})}">
                    <section class="guestbook">
                        <p class="guestbook__content">
                        </p>
                    </section>
                </a>
            </div>

            <!-- Section 3: Fin'd / Forum -->
            <section class="posts-section">
                <div class="content-tabs">
                    <button class="content-tabs__button active" id="tab-find" th:if="${isMyProfile}">Fin'd
                    </button>
                    <button class="content-tabs__button" id="tab-forum"
                            th:classappend="${!isMyProfile} ? 'active' : ''">
                        Forum
                    </button>
                </div>
                <div class="content-carousel-wrapper" id="carousel-wrapper">
                    <div class="content-carousel" id="carousel"></div>
                </div>
            </section>
            <div class="logout-section" th:if="${isMyProfile}">
                <button class="logout-button" id="logout-btn">로그아웃</button>
            </div>
        </main>
        <div th:replace="~{fragment/main-nav :: mainNavFragment}"></div>
    </div>

    <!-- [변경사항] 편집/비밀번호 변경 모달은 내 프로필일 때만 DOM에 포함되도록 th:if 추가 -->

    <!-- Edit Profile Modal -->
    <div class="modal-overlay" id="edit-profile-modal" th:if="${isMyProfile}">
        <div class="modal-content">
            <h1 class="modal-logo">PostHere</h1>
            <p class="modal-title">Edit your profile</p>
            <form id="edit-profile-form">
                <div class="input-group">
                    <label for="nickname">Nickname</label>
                    <div class="input-group-row">
                        <input id="nickname" name="nickname" placeholder="Enter new nickname" required type="text">
                        <button class="modal-button btn-secondary" id="check-nickname-btn" type="button">Check</button>
                    </div>
                    <p class="feedback-message" id="nickname-feedback"></p>
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <button class="modal-button btn-secondary" id="open-password-modal-btn" type="button">Change
                        Password
                    </button>
                </div>
                <div class="button-group">
                    <button class="modal-button btn-secondary" id="cancel-edit-btn" type="button">Cancel</button>
                    <button class="modal-button btn-primary" id="update-profile-btn" type="submit">Update</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal-overlay" id="change-password-modal" th:if="${isMyProfile}">
        <div class="modal-content">
            <h1 class="modal-logo">PostHere</h1>
            <p class="modal-title">Change your password</p>
            <form id="change-password-form">
                <div class="input-group">
                    <label for="new-password">New Password</label>
                    <input id="new-password" name="new-password" required type="password">
                </div>
                <div class="input-group">
                    <label for="confirm-password">Confirm Password</label>
                    <input id="confirm-password" name="confirm-password" required type="password">
                    <p class="feedback-message" id="password-feedback"></p>
                </div>
                <div class="button-group">
                    <button class="modal-button btn-secondary" id="cancel-password-btn" type="button">Cancel</button>
                    <button class="modal-button btn-primary" disabled id="update-password-btn" type="submit">Update
                        Password
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>
